(()=>{"use strict";var e={9012:(e,t,n)=>{n.r(t);var r=n(5629),o=n(7132),a=n(3244),s=n(4692),i=n(9526),l=n(83),c=n(885),u=n(2884),d=n(8719),f=n(7849),h=function(e){return e.Chat="Chat",e.History="History",e.Prompts="Prompts",e.Settings="Settings",e}({}),p=i.createContext({activeScreen:h.Chat,setActiveScreen:function(e){}}),x=n(5738),j=n(5352),g=n(7754),m=n(6650),y=n(2535),v=n(7557),b=function(e){var t=e.label,n=e.activeIcon,r=e.idleIcon,o=e.isActive,a=e.onPress;return(0,v.jsx)(j.default,{opacity:o?1:.5,py:"3",flex:1,onPress:a,children:(0,v.jsxs)(g.default,{children:[(0,v.jsx)(m.default,{mb:"1",as:o?n:r,color:"white",size:"sm"}),(0,v.jsx)(y.default,{color:"white",fontSize:"12",children:t})]})})},C=function(){var e=i.useContext(p),t=e.activeScreen,n=e.setActiveScreen;return(0,v.jsx)(b,{activeIcon:(0,v.jsx)(x.default,{name:"chatbox"}),idleIcon:(0,v.jsx)(x.default,{name:"chatbox-outline"}),isActive:t===h.Chat,label:"Chat",onPress:function(){return n(h.Chat)}})},w=function(){var e=i.useContext(p),t=e.activeScreen,n=e.setActiveScreen;return(0,v.jsx)(b,{activeIcon:(0,v.jsx)(x.default,{name:"archive"}),idleIcon:(0,v.jsx)(x.default,{name:"archive-outline"}),isActive:t===h.History,label:"History",onPress:function(){return n(h.History)}})},S=function(){var e=i.useContext(p),t=e.activeScreen,n=e.setActiveScreen;return(0,v.jsx)(b,{activeIcon:(0,v.jsx)(x.default,{name:"md-list"}),idleIcon:(0,v.jsx)(x.default,{name:"md-list-outline"}),isActive:t===h.Prompts,label:"Prompts",onPress:function(){return n(h.Prompts)}})},O=function(){var e=i.useContext(p),t=e.activeScreen,n=e.setActiveScreen;return(0,v.jsx)(b,{activeIcon:(0,v.jsx)(x.default,{name:"md-settings"}),idleIcon:(0,v.jsx)(x.default,{name:"md-settings-outline"}),isActive:t===h.Settings,label:"Settings",onPress:function(){return n(h.Settings)}})},k=n(481),P=n(3468),M=n(3034),A=n(6576),I=l.useDispatch,E=n(9468),G=(0,E.createAction)("store/messages/addMessage"),T=(0,E.createAction)("store/messages/clearMessage"),_=(0,E.createAction)("store/messages/removeLastMessage"),K=(0,E.createAction)("store/messages/appendIncomingMessage"),B=(0,E.createAction)("store/messages/clearIncomingMessage"),D=function(){var e=I(),t=i.useCallback((function(){e(T())}),[e]);return(0,v.jsx)(A.default,{icon:(0,v.jsx)(m.default,{as:M.default,name:"delete",size:"sm",color:"white"}),onPress:t})},H=l.useSelector,z=n(3806),F=function(e){return e.messages},N=(0,z.createSelector)([F],(function(e){return e.messages})),V=(0,z.createSelector)([F],(function(e){return e.incomingMessage})),Y=n(5202),R=n(8649),L=n(4333),U=n(2879),J=n(7221),W=function(e){var t=e.icon,n=e.content,r=e.background,o="normal"===(void 0===r?"normal":r)?"dark.200":"dark.100";return(0,v.jsxs)(f.default,{px:6,py:4,space:4,bgColor:o,children:[(0,v.jsx)(k.default,{flexGrow:0,flexShrink:0,children:t}),(0,v.jsx)(J.default,{flexGrow:1,flexShrink:1,flexBasis:0,children:n})]})},q=function(e){var t=e.content;return(0,v.jsx)(W,{icon:(0,v.jsx)(k.default,{pt:1,children:(0,v.jsx)(R.default,{bgColor:"dark.50",width:"24px",height:"24px",children:(0,v.jsx)(Y.default,{name:"robot",size:16,color:"white"})})}),content:(0,v.jsx)(U.default,{mergeStyle:!0,style:Q,children:t}),background:"alt"})},Q=L.default.create({body:{color:"#FFF"},blockquote:{backgroundColor:"#222"},code_inline:{backgroundColor:"#222"},code_block:{backgroundColor:"#222"},fence:{backgroundColor:"#222"}}),X=function(){var e=H(V);return e?(0,v.jsx)(q,{content:e}):null},Z=n(2640),$=function(e){var t=e.content;return(0,v.jsx)(W,{icon:(0,v.jsx)(R.default,{bgColor:"primary.600",width:"24px",height:"24px",children:(0,v.jsx)(Z.default,{name:"user",size:16,color:"white"})}),content:(0,v.jsx)(y.default,{color:"white",children:t})})},ee=function(){var e=H(N);return(0,v.jsxs)(d.default,{alignContent:"stretch",children:[e.map((function(e,t){return"user"===e.role?(0,v.jsx)($,{content:e.content},t):"assistant"===e.role?(0,v.jsx)(q,{content:e.content},t):void 0})),(0,v.jsx)(X,{})]})},te=n(6886),ne=n(8174),re=function(e){return e.GPT3_5="gpt-3.5-turbo",e.GPT4="gpt-4",e}({}),oe=n(5861),ae=n(5519),se=n(7216),ie=(0,E.createAsyncThunk)("store/settings/initApiKey",function(){var e=(0,oe.default)((function*(e,t){var n;n="web"===o.default.OS?yield ae.default.getItem("API_KEY"):yield se.getItemAsync("API_KEY"),yield t.dispatch(le(n||""))}));return function(t,n){return e.apply(this,arguments)}}()),le=(0,E.createAsyncThunk)("store/settings/updateApiKey",function(){var e=(0,oe.default)((function*(e){return"web"===o.default.OS?yield ae.default.setItem("API_KEY",e):yield se.setItemAsync("API_KEY",e),e}));return function(t){return e.apply(this,arguments)}}()),ce=(0,E.createAction)("store/settings/updateChatModel"),ue=function(e){return e.settings},de=(0,z.createSelector)([ue],(function(e){return e.apiKey})),fe=(0,z.createSelector)([ue],(function(e){return e.chatModel})),he=function(){var e=I(),t=H(fe),n=i.useCallback((function(t){var n=Object.values(re).find((function(e){return e===t}));n&&e(ce(n))}),[e]);return(0,v.jsxs)(te.default,{selectedValue:t,accessibilityLabel:"Choose Chat Model",placeholder:"Choose Chat Model",_selectedItem:{bg:"primary.600",endIcon:(0,v.jsx)(ne.CheckIcon,{size:"5"})},onValueChange:n,width:120,children:[(0,v.jsx)(te.default.Item,{label:"GPT3.5",value:re.GPT3_5}),(0,v.jsx)(te.default.Item,{label:"GPT4",value:re.GPT4})]})},pe=n(5455),xe=n.n(pe),je=n(8929),ge=n(9731),me=n(13),ye=n(2982),ve=l.useStore,be=n(4942),Ce=n(5671),we=n(3144),Se=n(89),Oe=n.n(Se),ke=n(386),Pe=n.n(ke);function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){(0,be.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie=function(){function e(t){(0,Ce.default)(this,e),this.apiKey=t.apiKey,this.commonHeaders={"Content-Type":"application/json",Authorization:"Bearer "+this.apiKey}}return(0,we.default)(e,[{key:"streamChat",value:function(){var e=(0,oe.default)((function*(e){var t=e.messages,n=e.config,r=e.onChunk,o=yield fetch("https://api.openai.com/v1/chat/completions",Ae({method:"POST",headers:this.commonHeaders,body:JSON.stringify(Ae(Ae({},n),{},{stream:!0,messages:t}))},{reactNative:{textStreaming:!0}}));if(!o.ok)throw new Error("Error: "+o.statusText);yield this.readChunks(o,r)}));return function(t){return e.apply(this,arguments)}}()},{key:"readChunks",value:function(){var e=(0,oe.default)((function*(e,t){var n,r=null==(n=e.body)?void 0:n.getReader();if(!r)throw new Error("Error: fail to read data from response");for(;;){var o=yield r.read(),a=o.done,s=o.value;if(a)break;t(this.parseChunkData(s))}}));return function(t,n){return e.apply(this,arguments)}}()},{key:"parseChunkData",value:function(e){return new TextDecoder("utf-8").decode(e).split("\n").map(Pe()).filter((function(e){return!!e})).map((function(e){return e.replace("data: ","")})).filter((function(e){return"[DONE]"!==e})).map((function(e){return JSON.parse(e)})).map((function(e){return Oe()(e,"choices.0.delta.content")})).join("")}}]),e}(),Ee=function(){var e=ve(),t=I(),n=function(){var e=I(),t=ve();return i.useCallback(function(){var n=(0,oe.default)((function*(n){var r=n.apiKey,o=n.inputMessages,a=new Ie({apiKey:r}),s=!1,i={model:fe(t.getState()),top_p:1,max_tokens:2048,temperature:.7};try{e(K("...")),yield a.streamChat({messages:[{role:"system",content:"You will always provide response in markdown format"}].concat((0,ye.default)(o)),config:i,onChunk:function(t){s||(s=!0,e(B())),e(K(t))}});var l=V(t.getState());e(B),e(G({role:"assistant",content:l}))}catch(c){throw e(_()),Object.hasOwn(c,"message")?new Error(c.message):new Error("Error happens")}finally{e(B())}}));return function(e){return n.apply(this,arguments)}}(),[e,t])}(),r=i.useCallback(function(){var r=(0,oe.default)((function*(r){var o=de(e.getState());if(!o)throw new Error("Please provide API Key");var a={role:"user",content:r.trim()};t(G(a));var s=N(e.getState()),i=[].concat((0,ye.default)(s),[a]);yield n({apiKey:o,inputMessages:i})}));return function(e){return r.apply(this,arguments)}}(),[n,t,e]);return r},Ge=function(){var e=I(),t=H(N),n=i.useState(xe()(t)?"Tell me about you in 20 words":""),r=(0,c.default)(n,2),a=r[0],s=r[1],l=H(V),u=Ee(),f=i.useCallback((0,oe.default)((function*(){try{s(""),yield u(a)}catch(e){s(a),alert(e.message)}})),[e,a]);return(0,v.jsx)(je.KeyboardAvoidingView,{h:{base:"400px",lg:"auto"},behavior:"ios"===o.default.OS?"padding":"height",children:(0,v.jsx)(W,{icon:(0,v.jsx)(k.default,{pt:1,children:(0,v.jsx)(R.default,{bgColor:"primary.600",width:"24px",height:"24px",children:(0,v.jsx)(Z.default,{name:"user",size:16,color:"white"})})}),content:(0,v.jsxs)(d.default,{space:"2",children:[(0,v.jsx)(ge.default,{borderColor:"primary.600",autoCompleteType:"off",placeholder:"Tell me about you in 20 words",value:a,onChangeText:function(e){return s(e)}}),(0,v.jsx)(me.Button,{onPress:f,isDisabled:!!l||!a,children:"Submit"})]})})})},Te=function(e){var t=e.title,n=e.buttons;return(0,v.jsxs)(f.default,{bg:"dark.50",px:"4",py:"4",justifyContent:"space-between",alignItems:"center",w:"100%",children:[(0,v.jsx)(f.default,{alignItems:"center",children:(0,v.jsx)(y.default,{color:"white",fontSize:"20",fontWeight:"bold",children:t})}),(0,v.jsx)(f.default,{children:n})]})},_e=function(){var e=H(de);return(0,v.jsxs)(d.default,{flexGrow:1,children:[(0,v.jsx)(k.default,{flexGrow:0,flexShrink:0,children:(0,v.jsx)(Te,{title:"Chat",buttons:(0,v.jsxs)(f.default,{space:2,children:[(0,v.jsx)(he,{}),(0,v.jsx)(D,{})]})})}),!e&&(0,v.jsx)(g.default,{py:4,children:"Please set Api Key before chat"}),e&&(0,v.jsxs)(P.ScrollView,{flexGrow:1,flexShrink:1,flexBasis:0,children:[(0,v.jsx)(ee,{}),(0,v.jsx)(Ge,{})]})]})},Ke=function(){return(0,v.jsx)(d.default,{flexGrow:1,children:(0,v.jsx)(k.default,{flexGrow:0,flexShrink:0,children:(0,v.jsx)(Te,{title:"History"})})})},Be=function(){return(0,v.jsx)(d.default,{flexGrow:1,children:(0,v.jsx)(k.default,{flexGrow:0,flexShrink:0,children:(0,v.jsx)(Te,{title:"Prompts"})})})},De=n(9865),He=n.n(De),ze=n(8347),Fe=n(2643),Ne=n(3618),Ve=function(e){var t=e.isOpen,n=e.onClose,r=I(),o=ve(),a=i.useState(""),s=(0,c.default)(a,2),l=s[0],u=s[1],d=i.useCallback((0,oe.default)((function*(){r(le(l)),n()})),[l,r,n]);return i.useEffect((function(){if(t){var e=de(o.getState());u(e)}}),[t,o]),(0,v.jsx)(ze.Modal,{isOpen:t,onClose:n,children:(0,v.jsxs)(ze.Modal.Content,{maxWidth:"80%",children:[(0,v.jsx)(ze.Modal.CloseButton,{}),(0,v.jsx)(ze.Modal.Header,{children:"Update Api Key"}),(0,v.jsx)(ze.Modal.Body,{children:(0,v.jsxs)(Fe.FormControl,{children:[(0,v.jsx)(Fe.FormControl.Label,{children:"Api Key"}),(0,v.jsx)(Ne.Input,{value:l,onChangeText:u})]})}),(0,v.jsx)(ze.Modal.Footer,{children:(0,v.jsxs)(me.Button.Group,{space:2,children:[(0,v.jsx)(me.Button,{variant:"ghost",colorScheme:"blueGray",onPress:n,children:"Cancel"}),(0,v.jsx)(me.Button,{onPress:d,children:"Save"})]})})]})})},Ye=function(){var e=H(de),t=i.useState(!1),n=(0,c.default)(t,2),r=n[0],o=n[1],a=i.useCallback((function(){o(!1)}),[]),s=i.useCallback((function(){o(!0)}),[]),l=i.useMemo((function(){return e?He()(e,{length:10,omission:""})+"******":"Not set"}),[e]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(k.default,{width:"90%",px:2,py:4,borderRadius:"sm",bgColor:"gray.800",children:(0,v.jsxs)(f.default,{alignItems:"center",justifyContent:"space-between",children:[(0,v.jsxs)(y.default,{color:"white",children:["Api Key: ",l]}),(0,v.jsx)(me.Button,{onPress:s,children:"Update"})]})}),(0,v.jsx)(Ve,{isOpen:r,onClose:a})]})},Re=function(){return(0,v.jsxs)(d.default,{flexGrow:1,children:[(0,v.jsx)(k.default,{flexGrow:0,flexShrink:0,children:(0,v.jsx)(Te,{title:"Settings"})}),(0,v.jsx)(P.ScrollView,{flexGrow:1,flexShrink:1,flexBasis:0,children:(0,v.jsx)(g.default,{py:4,children:(0,v.jsx)(Ye,{})})})]})},Le=function(){var e=i.useState(h.Chat),t=(0,c.default)(e,2),n=t[0],r=t[1],o=(0,u.useColorMode)(),a=o.colorMode,s=o.setColorMode;return i.useEffect((function(){"dark"!==a&&s("dark")}),[a,s]),(0,v.jsx)(p.Provider,{value:{activeScreen:n,setActiveScreen:r},children:(0,v.jsxs)(d.default,{height:"100%",width:"100%",bgColor:"dark.200",safeArea:!0,children:[(0,v.jsxs)(d.default,{alignItems:"stretch",flexGrow:1,children:[n===h.Chat&&(0,v.jsx)(_e,{}),n===h.History&&(0,v.jsx)(Ke,{}),n===h.Prompts&&(0,v.jsx)(Be,{}),n===h.Settings&&(0,v.jsx)(Re,{})]}),(0,v.jsxs)(f.default,{bg:"primary.600",alignItems:"center",shadow:6,flexGrow:0,flexShrink:0,children:[(0,v.jsx)(C,{}),(0,v.jsx)(w,{}),(0,v.jsx)(S,{}),(0,v.jsx)(O,{})]})]})})},Ue=function(){var e=I();return i.useEffect((function(){e(ie())}),[e]),null},Je=(0,E.createReducer)({messages:[],incomingMessage:""},(function(e){e.addCase(G,(function(e,t){e.messages.push(t.payload)})).addCase(T,(function(e){e.messages=[]})).addCase(_,(function(e){e.messages=e.messages.slice(0,-1)})).addCase(K,(function(e,t){e.incomingMessage=e.incomingMessage.concat(t.payload)})).addCase(B,(function(e){e.incomingMessage=""}))})),We={apiKey:"",chatModel:re.GPT3_5},qe=(0,E.createReducer)(We,(function(e){e.addCase(le.fulfilled,(function(e,t){e.apiKey=t.payload})).addCase(ce,(function(e,t){e.chatModel=t.payload}))})),Qe=(0,E.configureStore)({reducer:{settings:qe,messages:Je}}),Xe=(0,a.extendTheme)({useSystemColorMode:!1,initialColorMode:"dark"});const Ze=function(){return(0,v.jsx)(s.NativeBaseProvider,{theme:Xe,children:(0,v.jsxs)(l.Provider,{store:Qe,children:[(0,v.jsx)(Ue,{}),(0,v.jsx)(Le,{})]})})};if("web"!==o.default.OS){console.log("Platform.OS: ",o.default.OS);var $e=n(73).polyfill,et=n(1683).polyfill,tt=n(7421).polyfill,nt=n(2495).polyfill;et(),nt(),$e(),tt()}(0,r.default)(Ze)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,(()=>{var e=[];n.O=(t,r,o,a)=>{if(!r){var s=1/0;for(u=0;u<e.length;u++){for(var[r,o,a]=e[u],i=!0,l=0;l<r.length;l++)(!1&a||s>=a)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(i=!1,a<s&&(s=a));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,o,a]}})(),n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var s={};e=e||[null,t({}),t([]),t(t)];for(var i=2&o&&r;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,n.d(a,s),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/openai-chat-ui/",(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,a,[s,i,l]=r,c=0;if(s.some((t=>0!==e[t]))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var u=l(n)}for(t&&t(r);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n.O(void 0,[788],(()=>n(9012)));r=n.O(r)})();
//# sourceMappingURL=main.17f812f2.js.map